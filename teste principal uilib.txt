local Lib = loadstring(game:HttpGet("https://raw.githubusercontent.com/7yhx/kwargs_Ui_Library/main/source.lua"))()

local UI = Lib:Create{
   Theme = "Dark", -- ou qualquer outro tema
   Size = UDim2.new(0, 555, 0, 400) -- tamanho padrão
}

local Main = UI:Tab{
   Name = "Inicio"
}

local Divider = Main:Divider{
   Name = "Aimbot"
}

local VisualsTab = UI:Tab{Name = "Visuals"}
local ESPTab = UI:Tab{Name = "ESP"}

-- Variáveis
local AimingEnabled = true
local FullBrightEnabled = false
local DebugLineEnabled = true
local ESPEnabled = true

-- Aimbot
Main:Toggle{
    Name = "Aimbot",
    Default = AimingEnabled,
    Callback = function(val)
        AimingEnabled = val
    end
}

-- Visuals
VisualsTab:Toggle{
    Name = "FullBright",
    Default = FullBrightEnabled,
    Callback = function(val)
        FullBrightEnabled = val
        if val then
            Lighting.Brightness = 2
            Lighting.ClockTime = 12
            Lighting.FogEnd = 100000
            Lighting.GlobalShadows = false
            Lighting.OutdoorAmbient = Color3.fromRGB(128, 128, 128)
        else
            Lighting:ClearAllChildren()
        end
    end
}

VisualsTab:Toggle{
    Name = "DebugLine",
    Default = DebugLineEnabled,
    Callback = function(val)
        DebugLineEnabled = val
    end
}

-- ESP
ESPTab:Toggle{
    Name = "ESP",
    Default = ESPEnabled,
    Callback = function(val)
        ESPEnabled = val
    end
}

-- Dividers
Main:Divider{Name = "Aimbot Options"}
VisualsTab:Divider{Name = "Visual Enhancements"}
ESPTab:Divider{Name = "ESP Settings"}

-- Script de funcionalidades
local CircleRadius = 200
local Gravity = 50
local BulletSpeed = 2200
local TargetPlayer = nil
local RightMouseButtonHeld = false
local hue = 0
local PlayersList = {}

-- Cercle
local Circle = Drawing.new("Circle")
Circle.Visible = true
Circle.Thickness = 2
Circle.NumSides = 50
Circle.Radius = CircleRadius
Circle.Filled = false
Circle.Transparency = 0.5

-- Ligne debug
local DebugLine = Drawing.new("Line")
DebugLine.Color = Color3.fromRGB(0, 255, 0)
DebugLine.Thickness = 2
DebugLine.Transparency = 0.8
DebugLine.Visible = false

-- Funções Aimbot
local function getHeldItem(player)
    local target = player:FindFirstChild("CurrentSelectedObject")
    if target and target.Value and target.Value.Value then
        return target.Value.Value.Name
    end
    return nil
end

local function getBulletSpeed(player)
    local heldItemName = getHeldItem(player)
    local bulletSpeed = 2250

    if heldItemName then
        local gunData = Replicated:WaitForChild("GunData")
        local weapon = gunData:FindFirstChild(heldItemName)

        if weapon and weapon:FindFirstChild("Stats") and weapon.Stats:FindFirstChild("BulletSettings") then
            local bulletSpeedObj = weapon.Stats.BulletSettings:FindFirstChild("BulletSpeed")
            if bulletSpeedObj then
                bulletSpeed = bulletSpeedObj.Value
            end
        end
    end

    return bulletSpeed
end

local function updateCirclePosition()
    local screenSize = Camera.ViewportSize
    Circle.Position = Vector2.new(screenSize.X / 2, screenSize.Y / 2)
end

local function findNearestTargetToMouse()
    local nearestTarget = nil
    local shortestDistance = math.huge
    for _, player in pairs(Players:GetPlayers()) do
        if PlayersList[player.Name] and player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local screenPoint = Camera:WorldToViewportPoint(player.Character.HumanoidRootPart.Position)
            local mousePos = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
            local targetPos = Vector2.new(screenPoint.X, screenPoint.Y)
            local distance = (targetPos - mousePos).Magnitude
            if distance < CircleRadius and distance < shortestDistance then
                shortestDistance = distance
                nearestTarget = player
            end
        end
    end
    return nearestTarget
end

local function predictFuturePosition(pos, vel, speed, gravity)
    local distance = (pos - Camera.CFrame.Position).Magnitude
    local travelTime = distance / speed
    local future = pos + vel * travelTime
    local drop = distance > 100 and 0.5 * gravity * travelTime * travelTime or 0
    return future - Vector3.new(0, drop, 0)
end

local function aimAtTarget()
    if not TargetPlayer or not TargetPlayer.Character then return end
    local part = TargetPlayer.Character:FindFirstChild("ServerColliderHead")
    if part then
        local future = predictFuturePosition(part.Position, part.Velocity or Vector3.new(), BulletSpeed, Gravity)
        local screenPoint = Camera:WorldToViewportPoint(future)
        local mouseX, mouseY = Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2
        local deltaX = screenPoint.X - mouseX
        local deltaY = screenPoint.Y - mouseY
        mousemoverel(deltaX * 0.7, deltaY * 0.7)
    end
end

local function updateDebugLine()
    if not DebugLineEnabled then
        DebugLine.Visible = false
        return
    end
    local target = findNearestTargetToMouse()
    if target and target.Character then
        local part = target.Character:FindFirstChild("ServerColliderHead")
        if part then
            local future = predictFuturePosition(part.Position, part.Velocity or Vector3.new(), BulletSpeed, Gravity)
            local point = Camera:WorldToViewportPoint(future)
            DebugLine.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
            DebugLine.To = Vector2.new(point.X, point.Y)
            DebugLine.Visible = true
            return
        end
    end
    DebugLine.Visible = false
end

-- ESP Config
local config = {
    ESPEnabled = ESPEnabled,
    DistanceEnabled = true,
    BoxEnabled = true,
    NameEnabled = true,
    RefreshRate = 0.1,
    MaxDistance = 2400,
    Colors = {
        Box = Color3.fromRGB(255, 255, 255),
        Distance = Color3.fromRGB(0, 255, 0),
        Name = Color3.fromRGB(0, 0, 255),
    }
}

local ESPStorage = {}
local function createESP(player)
    if player == LocalPlayer then return end
    local box = Drawing.new("Square")
    box.Visible = false
    box.Color = config.Colors.Box
    box.Thickness = 2
    box.Transparency = 1
    box.Filled = false

    local distance = Drawing.new("Text")
    distance.Visible = false
    distance.Size = 16
    distance.Center = true
    distance.Outline = true
    distance.Color = config.Colors.Distance

    local name = Drawing.new("Text")
    name.Visible = false
    name.Size = 16
    name.Center = true
    name.Outline = true
    name.Color = config.Colors.Name
    name.Text = player.Name

    ESPStorage[player] = { Box = box, Distance = distance, Name = name }
end

local function removeESP(player)
    local esp = ESPStorage[player]
    if esp then
        for _, obj in pairs(esp) do obj:Remove() end
        ESPStorage[player] = nil
    end
end

local function updateESP()
    for _, player in pairs(Players:GetPlayers()) do
        local char = player.Character
        local hrp = char and char:FindFirstChild("HumanoidRootPart")
        if player ~= LocalPlayer and char and hrp then
            local esp = ESPStorage[player]
            if not esp then createESP(player) esp = ESPStorage[player] end

            local pos, onScreen = Camera:WorldToViewportPoint(hrp.Position + Vector3.new(0, 2.5, 0))
            local dist = (Camera.CFrame.Position - hrp.Position).Magnitude
            if onScreen and dist <= config.MaxDistance then
                local scale = 1 / (pos.Z * math.tan(math.rad(Camera.FieldOfView * 0.5)) * 2) * 1000
                local w, h = math.floor(4.5 * scale), math.floor(6 * scale)
                local x, y = math.floor(pos.X), math.floor(pos.Y)
                local xPos, yPos = x - w // 2, y - h // 2

                if config.BoxEnabled then
                    esp.Box.Size = Vector2.new(w, h)
                    esp.Box.Position = Vector2.new(xPos, yPos)
                    esp.Box.Visible = true
                else esp.Box.Visible = false end

                if config.DistanceEnabled then
                    esp.Distance.Text = string.format("[ %dm ]", math.floor(dist))
                    esp.Distance.Position = Vector2.new(x, yPos + h + 14)
                    esp.Distance.Visible = true
                else esp.Distance.Visible = false end

                if config.NameEnabled then
                    esp.Name.Text = player.Name
                    esp.Name.Position = Vector2.new(x, yPos - 18)
                    esp.Name.Visible = true
                else esp.Name.Visible = false end
            else
                esp.Box.Visible = false
                esp.Distance.Visible = false
                if esp.Name then esp.Name.Visible = false end
            end
        elseif ESPStorage[player] then
            removeESP(player)
        end
    end
end

-- Connexions
UserInputService.InputBegan:Connect(function(input, processed)
    if not processed then
        if input.KeyCode == Enum.KeyCode.F then
            AimingEnabled = not AimingEnabled
            print(AimingEnabled and "Aiming enabled" or "Aiming disabled")
        elseif input.UserInputType == Enum.UserInputType.MouseButton2 then
            RightMouseButtonHeld = true
        elseif input.KeyCode == Enum.KeyCode.D then
            DebugLineEnabled = not DebugLineEnabled
        end
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        RightMouseButtonHeld = false
    end
end)

Players.PlayerAdded:Connect(function(player)
    PlayersList[player.Name] = true
    createESP(player)
end)

Players.PlayerRemoving:Connect(function(player)
    PlayersList[player.Name] = nil
    removeESP(player)
end)

for _, player in pairs(Players:GetPlayers()) do
    PlayersList[player.Name] = true
    createESP(player)
end

-- Render loop
RunService.RenderStepped:Connect(function()
    hue = (hue + 1) % 360
    Circle.Color = Color3.fromHSV(hue / 360, 1, 1)
    updateCirclePosition()
    BulletSpeed = getBulletSpeed(LocalPlayer)
    updateDebugLine()

    if RightMouseButtonHeld and AimingEnabled then
        TargetPlayer = findNearestTargetToMouse()
        aimAtTarget()
    end

    if config.ESPEnabled then
        updateESP()
    end
end)
